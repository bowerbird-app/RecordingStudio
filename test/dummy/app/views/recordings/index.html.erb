<% content_for :title, "Recordings" %>

<%= render FlatPack::Breadcrumb::Component.new(class: "mb-4") do |breadcrumb| %>
  <% breadcrumb.item(text: "Home", href: root_path) %>
  <% breadcrumb.item(text: "Recordings") %>
<% end %>

<%= render FlatPack::Card::Component.new(class: "mb-6") do |card| %>
  <% card.header(divider: false) do %>
    <div>
      <h2 class="text-2xl font-semibold">Recordings</h2>
      <p class="text-sm text-slate-500">A complete history of activity across your workspace.</p>
    </div>
  <% end %>
<% end %>

<div class="mt-8 overflow-hidden rounded-lg border border-slate-200 bg-white">
  <% if @recordings.any? %>
    <%= render FlatPack::Table::Component.new(data: @recordings) do |table| %>
      <% table.column(
        title: "Recordable",
        html: ->(recording) { link_to(recordable_label(recording.recordable), recording_path(recording), class: "hover:underline") }
      ) %>

      <% table.column(title: "Type", html: ->(recording) { recording.recordable_type }) %>

      <% table.column(
        title: "Container",
        html: ->(recording) { "#{recording.container_type} ##{recording.container_id}" }
      ) %>

      <% table.column(
        title: "Status",
        html: ->(recording) {
          status_text = recording.trashed_at ? "Trashed" : "Active"
          status_style = recording.trashed_at ? :warning : :success
          render FlatPack::Badge::Component.new(text: status_text, style: status_style, size: :sm)
        }
      ) %>

      <% table.column(
        title: "Last updated by",
        html: ->(recording) {
          last_event = recording.events.recent.first
          actor_label(last_event&.actor)
        }
      ) %>

      <% table.column(title: "Updated", html: ->(recording) { "#{time_ago_in_words(recording.updated_at)} ago" }) %>

      <% table.with_action(text: "View", url: ->(recording) { recording_path(recording) }) %>
    <% end %>
  <% else %>
    <div class="px-6 py-10 text-center text-sm text-slate-500">
      No recordings yet.
    </div>
  <% end %>
</div>
