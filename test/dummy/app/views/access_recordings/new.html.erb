<% content_for :title, "Access" %>

<%= render FlatPack::Breadcrumb::Component.new(class: "mb-4") do |breadcrumb| %>
  <% breadcrumb.item(text: "Home", href: root_path) %>
  <% breadcrumb.item(text: "Workspaces", href: workspaces_path) %>
  <% breadcrumb.item(text: @root_recording.recordable.name, href: workspace_path(@root_recording.recordable)) %>
  <% if @parent_recording %>
    <% breadcrumb.item(
      text: recordable_label(@parent_recording.recordable),
      href: recording_path(@parent_recording)
    ) %>
  <% end %>
  <% breadcrumb.item(text: "Access") %>
<% end %>

<%= render FlatPack::Card::Component.new do |card| %>
  <% card.header(divider: false) do %>
    <div class="space-y-1">
      <h2 class="text-lg font-semibold">Add access</h2>
      <p class="text-sm text-slate-500">
        Grant access to
        <%= @parent_recording ? recordable_label(@parent_recording.recordable) : @root_recording.recordable.name %>.
      </p>
    </div>
  <% end %>

  <% card.body do %>
    <div class="space-y-4">
      <%= form_with url: access_recordings_path, method: :post, scope: :access, class: "space-y-6" do |form| %>
        <% if @parent_recording %>
          <%= hidden_field_tag :parent_recording_id, @parent_recording.id %>
        <% else %>
          <%= hidden_field_tag :root_recording_id, @root_recording.id %>
        <% end %>

        <% if @return_to.present? %>
          <%= hidden_field_tag :return_to, @return_to %>
        <% end %>

        <div class="space-y-2">
          <%= form.label :actor_key, "Actor", class: "text-sm font-medium text-slate-500" %>
          <%= form.select :actor_key,
            options_for_select(access_actor_options, params.dig(:access, :actor_key)),
            { include_blank: "Select an actor" },
            class: "w-full rounded-md border border-slate-200 bg-white/80 px-3 py-2 text-sm backdrop-blur" %>
        </div>

        <%= render FlatPack::RadioGroup::Component.new(
          name: "access[role]",
          label: "Role",
          options: RecordingStudio::Access.roles.keys.map { |k| [k.titleize, k] },
          value: @access.role.to_s,
          required: true
        ) %>

        <div class="flex items-center gap-3">
          <%= form.submit "Add", class: "rounded-md bg-slate-900 px-4 py-2 text-sm font-medium text-white" %>
          <%= link_to "Cancel", (@return_to || default_return_path), class: "text-sm font-medium text-slate-500" %>
        </div>
      <% end %>
    </div>
  <% end %>
<% end %>
